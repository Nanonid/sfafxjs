<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>SFAFx Test Set 1</title>
  <link rel="stylesheet" href="../bower_components/qunit/qunit/qunit.css">
  <style>
  div.data { white-space: pre; }
  </style>
</head>
<body>
  <div id="qunit"></div>
  <div id="qunit-fixture"></div>
<div class="data" id="record1">005.     UA
010.     M
102.     AF  744251
103.     J0667646
103/02.     I7424719
103/03.     I9797391
103/04.     I9343371
103/05.     I8954035
103/06.     I8110113
103/07.     I7737346
103/08.     I7632677
107.     19740722
108.     I7737346
110.     K275
113.     ALB
114.     2K04A2A
115.     W400
117.     58
118.     E
130.     1HX
142.     20200825
143.     20100825
144.     Y
200.     USAF
201.     PACOM
202.     PACAF
204.     PACAF
205.     11AF
206.     ELMENDORF
207.     611ASUS
208.     BEACN
209.     JFMOALASKA
300.     AK
301.     CAPE ROMANZOF
303.     614726N1655811W
304.     CZF
340.     G,AN/URN-005
343.     J/F 12/04752
357.     2
362.     ND
363.     V
373.     G
400.     AK
401.     CAPE ROMANZOF
403.     614726N1655811W
404.     CZF
406.     46
440.     G,RM-0004
442.     25
443.     J/F 12/04752
473.     G
500.     S401
502.     ALS 94-115
511.     AIR OPERATIONS
512.     NAVAIDS
513.     BEACON
520.     COORD WITH PHILLIPS FAA-AK 20100729
520.     SECOND LINE OF TEXT
701.     T02
702.     PACAF 2010-300
901.     A
911.     20100826
924.     FRRS
927.     19770429
928.     20100805
956.     RAB
958.     A
</div>
  <script src="../bower_components/qunit/qunit/qunit.js"></script>
  <script src="../sfafx.js"></script>
  <script>
    var error = 0.000000001;
    function approx( actual, expected ){
      var diff = Math.abs(actual-expected);
      return diff < error;
    }

    QUnit.config.reorder = false;
    var record1Elem, record1Data, record1;
    QUnit.test( "Global environment", function( assert ) {
      assert.ok( SFAFx, "SFAFx exists");
      assert.ok( SFAFx.toJSON, "SFAFx.toJSON exists");
      assert.ok( SFAFx.toSFAF, "SFAFx.toSFAF exists");
      record1Elem = document.getElementById('record1');
      assert.ok( record1Elem, "Record 1 element exists");
      record1Data = record1Elem.innerText;
      assert.ok( record1Data.length, "Record 1 data has length");
      assert.ok( record1Data.length > 200, "Record 1 data has non-trivial length");
    });
    QUnit.test( "SFAFx.toJSON", function( assert ) {
      var data = document.getElementById('record1').innerText;
      assert.ok( data, "Record1 SFAF data exists");
      var records = SFAFx.toJSON(data);
      assert.ok( records, "Records parsed" );
      assert.ok( Array.isArray(records), "Records is array" );
      assert.ok( records.length > 0, "Records has length > 0" );
      record1 = records[0];
      assert.ok( record1, "has record");
      assert.ok( record1.sfaf, "has sfaf property");
      assert.ok( record1.classification, "has classification property");
      assert.ok( record1.serial, "has serial property");
      assert.ok( record1.transmitter, "has transmitter property");
      assert.ok( record1.transmitter.location, "has transmitter.location property");
      assert.ok( record1.transmitter.location.lat, "has transmitter.location.lat property");
      assert.ok( record1.transmitter.location.lon, "has transmitter.location.lon property");
      assert.ok( record1.transmitter.location.coord, "has transmitter.location.coord property");
      var expCoord = [61.79055555555556, -165.96972222222223];
      assert.ok( approx(record1.transmitter.location.coord[0],expCoord[0]), "transmitter.location.coord[0] ~ " + expCoord[0]);
      assert.ok( approx(record1.transmitter.location.coord[1],expCoord[1]), "transmitter.location.coord[1] ~ " + expCoord[1]);
      assert.equal( record1.serial, "AF  744251", "serial property == AF  744251");
      assert.equal( record1.classification, "UA", "classification == UA");
      assert.ok( record1.sfaf["103"], "103 exists");
      assert.ok( record1.sfaf["103"].entry, "103 entry exists");
      assert.ok( record1.sfaf["103"].occur, "103 occur exists");
      assert.equal( record1.sfaf["103"].entry, "J0667646", "103 == J0667646");
      assert.ok( record1.sfaf["103"].occur["02"], '103/02 sfaf["103"].occur["02"] exists');
      assert.equal( record1.sfaf["103"].occur["02"].entry, "I7424719", 'sfaf["103"].occur["02"].entry == I7424719');
      assert.equal( record1.sfaf["103"].occur["08"].entry, "I7632677", 'sfaf["103"].occur["08"].entry == I7632677');
      assert.ok( Array.isArray(record1.sfaf["520"].entry), 'sfaf["520"].entry is an array');
      assert.ok( record1.sfaf["520"].entry.length == 2, 'sfaf["520"].entry is an array of length 2');
      assert.equal( record1.sfaf["520"].entry[1], "SECOND LINE OF TEXT", 'sfaf["520"].entry[1] == SECOND LINE OF TEXT');
      assert.equal( record1.sfaf["958"].entry, "A", 'sfaf["958"].entry == A');
    });
    QUnit.test( "SFAFx.toSFAF", function(assert){
      var originalData = document.getElementById('record1').innerText;
      assert.ok( originalData, "Record1 SFAF data exists");
      var records = SFAFx.toJSON(originalData);
      assert.ok( records, "Records parsed" );
      assert.ok( Array.isArray(records), "Records is array" );
      assert.ok( records.length > 0, "Records has length > 0" );
      var sfaf = records[0].sfaf;
      assert.ok( sfaf, "SFAFx JSON record exists");
      var sfaftxt = SFAFx.toSFAF(records);
      assert.ok( sfaftxt, "SFAF Text converted");
      assert.equal( originalData, sfaftxt, "Converted SFAF record is identical");
      var records2 = SFAFx.toJSON(sfaftxt);
      assert.ok( records2, "Reparsed OK");
      assert.deepEqual( records, records2, "Deep compare of reparsed SFAF record identical");
    });
  </script>
</body>
</html>
